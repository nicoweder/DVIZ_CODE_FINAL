<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nico Weder">

<title>Global Electricity and CO₂ Data Story</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="index_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="index_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap-9e3ffae467580fdb927a41352e75a2e0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">

<main class="content column-page" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Global Electricity and CO₂ Data Story</h1>
</div>



<div class="quarto-title-meta column-page">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Nico Weder </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Global energy production is constantly evolving. Since humans first harnessed electricity, there has been a drive to produce ever more of it, because the availability of electricity is closely linked to the prosperity of both nations and humanity as a whole. How electricity is generated also provides insight into a country’s level of development, as it reflects the use of modern, efficient, and sustainable technologies. For decades, global energy production has grown rapidly, driven largely by fossil fuels to meet rising demand.</p>
<p>However, since the 1990s, it has become increasingly clear that this approach is unsustainable. Energy production, particularly from fossil fuels, is a major driver of climate change. Because burning fossil fuels releases large amounts of carbon dioxide and other greenhouse gases into the atmosphere, trapping heat in our atmosphere. Research has shown that the future of energy lies in renewable sources, which are the only way to ensure long-term, sustainable electricity generation.</p>
<p>In this report, I aim to show the development of electricity production, demonstrate the economic benefits of renewable energy production and to explore the progress of the global energy transition (are we able to meet climate change targets) by combining and analysing data of three datasets.</p>
<ul>
<li>First data from a dataset which provides time‑series data on annual electricity generation by source for countries around the world (https://www.kaggle.com/datasets/valchovalev/electricityprodsourcestacked).</li>
<li>Then a dataset which containes the levelized cost of electricity (lcoe) for diffrent sources (https://datacatalog.worldbank.org/search/dataset/0038036/global-data-on-levelized-cost-of-electricity-generation-lcoe).</li>
<li>Finally, a dataset which includes data on CO₂ emissions of persons or countries in a given time (https://github.com/owid/co2-data?tab=readme-ov-file).</li>
</ul>
</section>
<section id="development-of-electricity-production" class="level2">
<h2 class="anchored" data-anchor-id="development-of-electricity-production">Development of electricity production</h2>
<p>This chart shows the historical development of global electricity production. Electricity generated from fossil fuels is shown in shades of grey, while renewable sources such as hydro, wind, solar, and bioenergy are highlighted with distinct colors and hatching. Nuclear energy is shown separately in puple because, although it is low-carbon like renewables, it is not classified as a renewable source due to its reliance on finite uranium resources. This chart is presented to illustrate the changing energy mix over time and highlight the rapid growth of renewables in contrast to the persistent dominance of fossil fuels.</p>
<div id="7f9f3286" class="cell" data-message="false" data-execution_count="1">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-2-output-1.png" width="943" height="559" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="key-insights" class="level3">
<h3 class="anchored" data-anchor-id="key-insights">Key insights</h3>
<ul>
<li><p>Most energy sources are growing, including non-renewable ones. This is because electricity is needed for almost everything in today’s world, and new technologies are constantly being developed, creating ever-increasing demand, for example, the internet.</p></li>
<li><p>Only nuclear and gas energy production remains constant, which in the case of nuclear power is due to safety concerns. For gas, it’s likely because it primarily serves to balance increased demand in the short term and is not a primary energy source.</p></li>
<li><p>All renewable energy sources have seen a strong increase over the past 20 years. This is due to the recognition of the urgent need to develop renewables in the fight against climate change.</p></li>
</ul>
</section>
</section>
<section id="electricity-production-renewable-vs-fossil-fuels" class="level2">
<h2 class="anchored" data-anchor-id="electricity-production-renewable-vs-fossil-fuels">Electricity Production: Renewable vs Fossil Fuels</h2>
<p>The following diagram shows the development of renewable energies in green compared to non-renewable energies, which are shown in grey. Three points in time are highlighted because they either marked a decisive turning point or anomalies. This diagram is presented to emphasize the accelerating growth of renewable energy and to pinpoint events that influenced global energy production and are clearly visible at a glance.</p>
<div id="245ece0f" class="cell" data-message="false" data-execution_count="2">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-3-output-1.png" width="943" height="559" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="key-insights-1" class="level3">
<h3 class="anchored" data-anchor-id="key-insights-1">Key insights</h3>
<ul>
<li>The 2008 Financial Crisis is visible in the graph as a noticeable slowdown in global electricity production, particularly from fossil fuels. This reflects how economic disruptions reduce industrial activity and overall energy demand.</li>
<li>The COVID situation around 2020 shows exactly the same impact on energy production as the financial crisis from 2008. Interestingly, there is hardly any change in renewable energies at these times. This could be attributed to the increased demand for green electricity.</li>
<li>Renewable energies have increased sharply since the year 2000, due to the international effort to combat climate change. It is clearly evident, by looking at this illustration, that the increase in renewable energies follows an exponential growth pattern.</li>
</ul>
</section>
</section>
<section id="share-of-renewable-in-global-electricity-production" class="level2">
<h2 class="anchored" data-anchor-id="share-of-renewable-in-global-electricity-production">Share of Renewable in Global Electricity Production</h2>
<p>This Visualisation shows the share of renewable energy in global electricity production over time. It aims to illustrate even more clearly how renewable energies are gaining significant relevance in global electricity production. By visualizing the ratio of renewable to non-renewable energies, it becomes even more apparent which path we are on.</p>
<div id="9ce3d50e" class="cell" data-message="false" data-execution_count="3">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-4-output-1.png" width="943" height="559" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="key-insights-2" class="level3">
<h3 class="anchored" data-anchor-id="key-insights-2">Key insights</h3>
<ul>
<li>In the previous diagram, we saw that renewables began to grow strongly from 2000 onwards. Combining this with the current diagram, we can observe that the ratio initially changed very little. However, a few years later, the share of renewables also increased sharply. This indicates that not only did renewable energy expand, but the growth of non-renewable sources began to slow around 2007.</li>
<li>Although renewable energy grows exponentially, its share compared to non-renewables rises only linearly or slightly exponential because fossil fuel production is still increasing (just a little bit slower).</li>
<li>The share of renewable energies increases by between 0.7% and 1.5% per year. If this trend continues, we will obtain 50% of our energy from renewable sources in 10 to 15 years, and in approximately 60 years we would obtain 100% of our energy from renewable sources. Despite the decline in growth of non-renewable energies, is this pace far too slow to meet our climate change targets.</li>
</ul>
</section>
</section>
<section id="levelized-cost-of-electricity-for-each-technology" class="level2">
<h2 class="anchored" data-anchor-id="levelized-cost-of-electricity-for-each-technology">Levelized Cost of Electricity for each Technology</h2>
<p>While the previous charts focused on how electricity production has evolved over time, this diagram shifts the focus to the economic perspective by comparing the levelized cost of electricity (LCOE) across different power generation technologies. The LCOE represents the average cost of generating one unit of electricity over the entire lifetime of a power plant, including investment, operation, and maintenance costs.This comparison provides insight into how competitive renewable energy sources are relative to conventional fossil and nuclear technologies, helping to explain why certain energy sources are expanding more rapidly than others. The Boxplots in green show the lcoe of a renewable source and the boxplots in grey show the lcoe of fossile energy sources.</p>
<div id="a2e6732b" class="cell" data-message="false" data-execution_count="4">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-5-output-1.png" width="944" height="559" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="key-insights-3" class="level3">
<h3 class="anchored" data-anchor-id="key-insights-3">Key insights</h3>
<ul>
<li>Renewable energy sources such as solar PV, onshore wind, and hydropower are among the most cost-effective electricity generation technologies today. Decades of technological development and scaling have allowed them to compete directly with non-renewable alternatives.</li>
<li>Newer renewable technologies, such as solar CSP, are not yet mature enough to compete on price. However, with continued innovation and investment, they may also become cost-competitive in the future. Importantly, solar and hydropower were not always cheaper than fossil fuels either. Giving emerging technologies time and support to develop is therefore crucial, as this is the only way to ensure a sufficient renewable energy supply in a future where electricity demand is expected to grow significantly.</li>
<li>Although some renewable technologies are already cheaper than traditional energy sources, they have not yet fully replaced them because of existing infrastructure lock-in, the need for reliable base-load power, and the continued reliance on fossil fuels to balance supply and demand. However, in the long term, economic incentives alone should lead to fossil fuel energy production becoming obsolete.</li>
</ul>
</section>
</section>
<section id="co₂-per-capita-vs-renewable-share" class="level2">
<h2 class="anchored" data-anchor-id="co₂-per-capita-vs-renewable-share">Co₂ per Capita vs Renewable Share</h2>
<p>While the previous diagram focused on the cost competitiveness of different energy technologies, this final chart brings the discussion back to environmental outcomes by linking electricity production to emissions. It illustrates how the share of renewable energy in a country’s electricity mix relates to its CO₂ emissions per capita, highlighting the role renewables play in reducing climate impacts.</p>
<div id="8681a309" class="cell" data-message="false" data-execution_count="5">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-6-output-1.png" width="892" height="559" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="key-insights-4" class="level3">
<h3 class="anchored" data-anchor-id="key-insights-4">Key insights</h3>
<ul>
<li>Countries with a higher share of renewable energy tend to have lower CO₂ emissions per capita. This is mainly because fossil fuel–based electricity generation releases large amounts of greenhouse gases, including CO₂, whereas renewables produce little to none during operation.</li>
<li>More economically and technologically advanced countries are generally more likely to have a higher share of renewable energy, as they have greater financial and institutional capacity to invest in clean technologies. However, this relationship is not universal, as countries like Brazil achieve high renewable shares largely due to favorable natural conditions rather than overall economic development.</li>
<li>The total amount of electricity a country consumes does not appear to be directly linked to either CO₂ emissions per capita or the share of renewables, because emissions depend more on how electricity is generated than on how much is used, and high demand can be met with both clean and carbon-intensive energy sources.</li>
<li>Some countries combine a high share of renewable electricity with relatively high CO₂ emissions per capita; Norway, for example, produces most of its electricity from hydropower but still has a sizeable carbon footprint due to high overall energy consumption, oil and gas extraction(not consumption), and transport emissions.</li>
<li>Countries with very low shares of renewable energy can exhibit extremely high CO₂ emissions per capita; Qatar, for instance, relies almost entirely on fossil fuels and has energy-intensive industries and high cooling demand, which together drive its exceptionally high per-capita emissions.</li>
</ul>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>This data story shows that the global energy system is clearly in transition, but that the pace of change is still far from sufficient. Electricity production continues to grow steadily as societies become more digital, connected, and energy-dependent. While renewable energy sources such as wind, solar, and hydropower have expanded rapidly over the past two decades, fossil fuels remain the dominant source of global electricity.</p>
<p>From an economic perspective, the results are encouraging. Many renewable technologies are already among the cheapest ways to generate electricity, which removes one of the strongest arguments against the energy transition. The fact that fossil fuels are still widely used is therefore not primarily a cost issue, but rather the result of existing infrastructure, political decisions, and the need for reliable energy supply during the transition period.</p>
<p>The environmental analysis highlights why this transition matters. Countries with higher shares of renewable electricity generally emit less CO₂ per capita, demonstrating the direct climate benefits of clean energy. Overall, the findings suggest that the direction is right, but the speed is not. If current trends continue, reaching global climate targets will be extremely difficult. Accelerating the expansion of renewables, reducing reliance on fossil fuels, and addressing structural barriers are essential steps if the global energy system is to become truly sustainable in time.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>